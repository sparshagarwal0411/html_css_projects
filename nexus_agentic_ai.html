<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nexus AI Assistant - Enhanced</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #000000;
            background-image: 
                radial-gradient(circle at 20% 50%, rgba(0, 255, 204, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(0, 191, 255, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(0, 255, 136, 0.1) 0%, transparent 50%),
                linear-gradient(135deg, #000000 0%, #0a0a0a 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                repeating-linear-gradient(
                    90deg,
                    transparent,
                    transparent 2px,
                    rgba(0, 255, 204, 0.03) 2px,
                    rgba(0, 255, 204, 0.03) 4px
                );
            pointer-events: none;
            z-index: 1;
        }

        .app-container {
            width: 95%;
            max-width: 1200px;
            height: 90vh;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            border: 2px solid;
            border-image: linear-gradient(135deg, #00ffcc, #00bfff, #00ff88) 1;
            box-shadow: 
                0 0 50px rgba(0, 255, 204, 0.3),
                0 0 100px rgba(0, 191, 255, 0.2),
                inset 0 1px 0 rgba(0, 255, 204, 0.2);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
            z-index: 2;
        }

        .app-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, 
                rgba(0, 255, 204, 0.05) 0%, 
                rgba(0, 191, 255, 0.05) 50%, 
                rgba(0, 255, 136, 0.05) 100%);
            border-radius: 22px;
            pointer-events: none;
        }

        .header {
            background: rgba(0, 0, 0, 0.8);
            padding: 16px 24px;
            border-bottom: 2px solid rgba(0, 255, 204, 0.3);
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: relative;
            z-index: 3;
            min-height: 60px;
        }

        .header::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, #00ffcc, #00bfff, #00ff88);
            box-shadow: 0 0 10px rgba(0, 255, 204, 0.5);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            flex-shrink: 0;
        }

        .logo-icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(45deg, #00ffcc, #00bfff);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: bold;
            color: #000;
            animation: techPulse 2s infinite;
            box-shadow: 
                0 0 15px rgba(0, 255, 204, 0.5),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            flex-shrink: 0;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        }

        @keyframes techPulse {
            0%, 100% { 
                transform: scale(1);
                box-shadow: 0 0 20px rgba(0, 255, 204, 0.5);
            }
            50% { 
                transform: scale(1.05);
                box-shadow: 0 0 30px rgba(0, 255, 204, 0.8);
            }
        }

        .logo h1 {
            color: #00ffcc;
            font-size: 18px;
            font-weight: 700;
            background: linear-gradient(45deg, #00ffcc, #00bfff, #00ff88);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 20px rgba(0, 255, 204, 0.5);
            filter: drop-shadow(0 0 10px rgba(0, 255, 204, 0.3));
            margin: 0;
            white-space: nowrap;
            line-height: 1;
        }

        .stats {
            display: flex;
            gap: 20px;
            color: #00ffcc;
            font-size: 14px;
            text-shadow: 0 0 10px rgba(0, 255, 204, 0.5);
        }

        .nav-controls {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .nav-btn {
            padding: 8px 16px;
            background: rgba(0, 255, 204, 0.1);
            border: 1px solid rgba(0, 255, 204, 0.3);
            border-radius: 12px;
            color: #00ffcc;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .nav-btn:hover {
            background: rgba(0, 255, 204, 0.2);
            border-color: rgba(0, 255, 204, 0.6);
            transform: translateY(-1px);
            box-shadow: 0 3px 10px rgba(0, 255, 204, 0.3);
        }

        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .message {
            display: flex;
            gap: 12px;
            animation: slideInUp 0.3s ease-out;
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.user {
            justify-content: flex-end;
        }

        .message.ai {
            justify-content: flex-start;
        }

        .message-content {
            max-width: 70%;
            padding: 16px 20px;
            border-radius: 20px;
            position: relative;
            word-wrap: break-word;
            line-height: 1.5;
        }

        .message.user .message-content {
            background: linear-gradient(135deg, #00ffcc, #00bfff);
            color: #000;
            border-bottom-right-radius: 8px;
            box-shadow: 
                0 0 20px rgba(0, 255, 204, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        .message.ai .message-content {
            background: rgba(0, 0, 0, 0.8);
            color: #00ffcc;
            border: 1px solid rgba(0, 255, 204, 0.3);
            border-bottom-left-radius: 8px;
            box-shadow: 
                0 0 20px rgba(0, 255, 204, 0.2),
                inset 0 1px 0 rgba(0, 255, 204, 0.1);
        }

        .avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            flex-shrink: 0;
        }

        .user-avatar {
            background: linear-gradient(45deg, #00ffcc, #00bfff);
            color: #000;
            box-shadow: 0 0 15px rgba(0, 255, 204, 0.5);
        }

        .ai-avatar {
            background: linear-gradient(45deg, #00bfff, #00ff88);
            color: #000;
            box-shadow: 0 0 15px rgba(0, 191, 255, 0.5);
        }

        .input-container {
            padding: 20px 30px;
            background: rgba(0, 0, 0, 0.8);
            border-top: 2px solid rgba(0, 255, 204, 0.3);
            position: relative;
        }

        .input-container::before {
            content: '';
            position: absolute;
            top: -2px;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, #00ffcc, #00bfff, #00ff88);
            box-shadow: 0 0 10px rgba(0, 255, 204, 0.5);
        }

        .input-wrapper {
            display: flex;
            gap: 12px;
            align-items: flex-end;
            background: rgba(0, 0, 0, 0.6);
            border-radius: 20px;
            padding: 12px 16px;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(0, 255, 204, 0.3);
            box-shadow: 
                0 0 30px rgba(0, 255, 204, 0.2),
                inset 0 1px 0 rgba(0, 255, 204, 0.1);
        }

        .input-controls {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .file-input {
            display: none;
        }

        .control-btn {
            width: 40px;
            height: 40px;
            border: none;
            border-radius: 50%;
            background: rgba(0, 255, 204, 0.1);
            border: 1px solid rgba(0, 255, 204, 0.3);
            color: #00ffcc;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            box-shadow: 0 0 10px rgba(0, 255, 204, 0.2);
        }

        .control-btn:hover {
            background: rgba(0, 255, 204, 0.2);
            border-color: rgba(0, 255, 204, 0.6);
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(0, 255, 204, 0.4);
        }

        .control-btn.active {
            background: linear-gradient(45deg, #00ffcc, #00bfff);
            color: #000;
            box-shadow: 0 0 25px rgba(0, 255, 204, 0.6);
        }

        .message-input {
            flex: 1;
            background: transparent;
            border: none;
            outline: none;
            color: #00ffcc;
            font-size: 16px;
            resize: none;
            min-height: 24px;
            max-height: 120px;
            line-height: 1.5;
            text-shadow: 0 0 5px rgba(0, 255, 204, 0.3);
        }

        .message-input::placeholder {
            color: rgba(0, 255, 204, 0.6);
        }

        .send-btn {
            width: 44px;
            height: 44px;
            border: none;
            border-radius: 50%;
            background: linear-gradient(45deg, #00ffcc, #00bfff);
            color: #000;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            transition: all 0.3s ease;
            box-shadow: 
                0 0 25px rgba(0, 255, 204, 0.5),
                0 4px 15px rgba(0, 255, 204, 0.3);
        }

        .send-btn:hover {
            transform: scale(1.05);
            box-shadow: 
                0 0 35px rgba(0, 255, 204, 0.7),
                0 6px 20px rgba(0, 255, 204, 0.4);
        }

        .send-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: 0 0 10px rgba(0, 255, 204, 0.2);
        }

        .typing-indicator {
            display: flex;
            gap: 4px;
            padding: 16px 20px;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #00ffcc;
            animation: techTyping 1.4s infinite ease-in-out;
            box-shadow: 0 0 8px rgba(0, 255, 204, 0.5);
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes techTyping {
            0%, 60%, 100% {
                transform: translateY(0);
                box-shadow: 0 0 8px rgba(0, 255, 204, 0.5);
            }
            30% {
                transform: translateY(-10px);
                box-shadow: 0 0 15px rgba(0, 255, 204, 0.8);
            }
        }

        .image-preview {
            display: flex;
            gap: 8px;
            margin-bottom: 8px;
            flex-wrap: wrap;
        }

        .preview-image {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 8px;
            border: 2px solid rgba(0, 255, 204, 0.5);
            box-shadow: 0 0 15px rgba(0, 255, 204, 0.3);
        }

        .remove-image {
            position: absolute;
            top: -6px;
            right: -6px;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #00bfff;
            color: #000;
            border: none;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 10px rgba(0, 191, 255, 0.5);
        }

        .preview-container {
            position: relative;
            display: inline-block;
        }

        .welcome-message {
            text-align: center;
            color: #00ffcc;
            padding: 40px 20px;
            text-shadow: 0 0 10px rgba(0, 255, 204, 0.5);
        }

        .welcome-message h2 {
            font-size: 28px;
            margin-bottom: 16px;
            background: linear-gradient(45deg, #00ffcc, #00bfff, #00ff88);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            filter: drop-shadow(0 0 10px rgba(0, 255, 204, 0.3));
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .feature-card {
            background: rgba(0, 255, 204, 0.05);
            padding: 24px;
            border-radius: 16px;
            border: 1px solid rgba(0, 255, 204, 0.2);
            text-align: center;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .feature-card:hover {
            transform: translateY(-4px);
            background: rgba(0, 255, 204, 0.1);
            border-color: rgba(0, 255, 204, 0.4);
            box-shadow: 0 10px 30px rgba(0, 255, 204, 0.2);
        }

        .feature-icon {
            font-size: 32px;
            margin-bottom: 12px;
            filter: drop-shadow(0 0 10px rgba(0, 255, 204, 0.3));
        }

        .feature-card h3 {
            color: #00ffcc;
            margin-bottom: 8px;
            font-size: 18px;
        }

        .feature-card p {
            color: rgba(0, 255, 204, 0.8);
            font-size: 14px;
            line-height: 1.4;
        }

        .math-result {
            background: rgba(0, 255, 204, 0.1);
            padding: 16px;
            border-radius: 12px;
            border: 1px solid rgba(0, 255, 204, 0.3);
            margin: 8px 0;
            font-family: 'Courier New', monospace;
        }

        .calculation {
            font-size: 18px;
            font-weight: bold;
            color: #00ffcc;
            text-align: center;
        }

        .ai-thinking {
            opacity: 0.7;
            font-style: italic;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; }
        }

        .error-message {
            background: rgba(255, 100, 100, 0.1);
            border: 1px solid rgba(255, 100, 100, 0.3);
            color: #ff6464;
            padding: 12px;
            border-radius: 8px;
            margin: 8px 0;
        }

        @media (max-width: 768px) {
            .app-container {
                width: 100%;
                height: 100vh;
                border-radius: 0;
            }

            .header {
                padding: 16px 20px;
            }

            .logo h1 {
                font-size: 16px;
            }

            .stats {
                display: none;
            }

            .message-content {
                max-width: 85%;
            }

            .input-container {
                padding: 16px 20px;
            }

            .feature-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Additional enhancement styles */
        .response-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            color: rgba(0, 255, 204, 0.7);
            font-size: 12px;
            margin-top: 8px;
        }

        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #00ffcc;
            animation: statusPulse 2s infinite;
        }

        @keyframes statusPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        .message-actions {
            display: flex;
            gap: 8px;
            margin-top: 8px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .message:hover .message-actions {
            opacity: 1;
        }

        .action-btn {
            padding: 4px 8px;
            background: rgba(0, 255, 204, 0.1);
            border: 1px solid rgba(0, 255, 204, 0.2);
            border-radius: 6px;
            color: #00ffcc;
            font-size: 12px;
            cursor: pointer;
        }

        .action-btn:hover {
            background: rgba(0, 255, 204, 0.2);
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="header">
            <div class="logo">
                <div class="logo-icon">N</div>
                <div>
                    <h1>Nexus AI Assistant</h1>
                    <div style="font-size: 10px; color: rgba(0, 255, 204, 0.7); margin-top: -2px;">Made by BrainStormer Group</div>
                </div>
            </div>
            <div class="nav-controls">
                <div style="display: flex; align-items: center; gap: 8px; color: #00ffcc; font-size: 12px;">
                    <span style="width: 8px; height: 8px; background: #00ff00; border-radius: 50%; box-shadow: 0 0 8px #00ff00;"></span>
                    <span>Powered by Google</span>
                </div>
                <button class="nav-btn" id="homeBtn">
                    <span>🏠</span>
                    <span>Home</span>
                </button>
                <button class="nav-btn" id="clearBtn">
                    <span>🗑️</span>
                    <span>Clear</span>
                </button>
                <div class="stats">
                    <div>💬 <span id="messageCount">0</span> messages</div>
                    <div>🔍 Web Search</div>
                    <div>🧮 Calculator</div>
                    <div>📱 Enhanced</div>
                </div>
            </div>
        </div>

        <div class="chat-container">
            <div class="messages" id="messages">
                <div class="welcome-message">
                    <h2>Welcome to Nexus AI Assistant! 🚀</h2>
                    <p>Your enhanced AI companion with advanced mathematical capabilities, intelligent responses, and modern interface.</p>
                    
                    <div class="feature-grid">
                        <div class="feature-card">
                            <div class="feature-icon">🧮</div>
                            <h3>Advanced Calculator</h3>
                            <p>Complex mathematical operations, scientific functions, and equation solving</p>
                        </div>
                        <div class="feature-card">
                            <div class="feature-icon">💬</div>
                            <h3>Smart Conversations</h3>
                            <p>Contextual responses with improved natural language understanding</p>
                        </div>
                        <div class="feature-card">
                            <div class="feature-icon">🎤</div>
                            <h3>Voice Commands</h3>
                            <p>Speak naturally and get instant voice-to-text conversion</p>
                        </div>
                        <div class="feature-card">
                            <div class="feature-icon">📸</div>
                            <h3>Image Analysis</h3>
                            <p>Upload images for AI-powered analysis and description</p>
                        </div>
                        <div class="feature-card">
                            <div class="feature-icon">⚡</div>
                            <h3>Real-time Processing</h3>
                            <p>Instant responses with enhanced performance optimization</p>
                        </div>
                        <div class="feature-card">
                            <div class="feature-icon">🌐</div>
                            <h3>Global Knowledge</h3>
                            <p>Access to comprehensive information across all domains</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="input-container">
                <div class="input-wrapper">
                    <div class="input-controls">
                        <input type="file" id="imageInput" class="file-input" accept="image/*" multiple>
                        <button class="control-btn" id="imageBtn" title="Upload Image">📷</button>
                        <button class="control-btn" id="voiceBtn" title="Voice Input">🎤</button>
                    </div>
                    
                    <div style="flex: 1;">
                        <div id="imagePreview" class="image-preview"></div>
                        <textarea 
                            id="messageInput" 
                            class="message-input" 
                            placeholder="Try: '2+2', 'sqrt(64)', 'what is AI?', or upload an image!"
                            rows="1"
                        ></textarea>
                    </div>
                    
                    <button class="send-btn" id="sendBtn">
                        <span>➤</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        class EnhancedNexusAI {
            constructor() {
                this.messageCount = 0;
                this.isListening = false;
                this.uploadedImages = [];
                this.recognition = null;
                this.isProcessing = false;
                this.initializeElements();
                this.initializeSpeechRecognition();
                this.bindEvents();
                this.loadConversationHistory();
            }

            initializeElements() {
                this.messagesContainer = document.getElementById('messages');
                this.messageInput = document.getElementById('messageInput');
                this.sendBtn = document.getElementById('sendBtn');
                this.voiceBtn = document.getElementById('voiceBtn');
                this.imageBtn = document.getElementById('imageBtn');
                this.imageInput = document.getElementById('imageInput');
                this.imagePreview = document.getElementById('imagePreview');
                this.messageCountEl = document.getElementById('messageCount');
                this.homeBtn = document.getElementById('homeBtn');
                this.clearBtn = document.getElementById('clearBtn');
            }

            initializeSpeechRecognition() {
                if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                    this.recognition = new SpeechRecognition();
                    this.recognition.continuous = false;
                    this.recognition.interimResults = false;
                    this.recognition.lang = 'en-US';

                    this.recognition.onstart = () => {
                        this.isListening = true;
                        this.voiceBtn.classList.add('active');
                        this.voiceBtn.innerHTML = '🔴';
                    };

                    this.recognition.onresult = (event) => {
                        const transcript = event.results[0][0].transcript;
                        this.messageInput.value = transcript;
                        this.adjustTextareaHeight();
                    };

                    this.recognition.onend = () => {
                        this.isListening = false;
                        this.voiceBtn.classList.remove('active');
                        this.voiceBtn.innerHTML = '🎤';
                    };

                    this.recognition.onerror = (event) => {
                        console.error('Speech recognition error:', event.error);
                        this.isListening = false;
                        this.voiceBtn.classList.remove('active');
                        this.voiceBtn.innerHTML = '🎤';
                    };
                }
            }

            bindEvents() {
                this.sendBtn.addEventListener('click', () => this.sendMessage());
                this.messageInput.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        this.sendMessage();
                    }
                });

                this.messageInput.addEventListener('input', () => {
                    this.adjustTextareaHeight();
                });

                this.voiceBtn.addEventListener('click', () => this.toggleVoiceRecognition());
                this.imageBtn.addEventListener('click', () => this.imageInput.click());
                this.imageInput.addEventListener('change', (e) => this.handleImageUpload(e));
                this.homeBtn.addEventListener('click', () => this.goHome());
                this.clearBtn.addEventListener('click', () => this.clearChat());
            }

            adjustTextareaHeight() {
                this.messageInput.style.height = 'auto';
                this.messageInput.style.height = Math.min(this.messageInput.scrollHeight, 120) + 'px';
            }

            toggleVoiceRecognition() {
                if (!this.recognition) {
                    alert('Speech recognition is not supported in your browser');
                    return;
                }

                if (this.isListening) {
                    this.recognition.stop();
                } else {
                    this.recognition.start();
                }
            }

            handleImageUpload(event) {
                const files = Array.from(event.target.files);
                
                files.forEach(file => {
                    if (file.type.startsWith('image/')) {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            const imageData = {
                                name: file.name,
                                data: e.target.result,
                                file: file
                            };
                            this.uploadedImages.push(imageData);
                            this.updateImagePreview();
                        };
                        reader.readAsDataURL(file);
                    }
                });
            }

            updateImagePreview() {
                this.imagePreview.innerHTML = '';
                this.uploadedImages.forEach((image, index) => {
                    const previewContainer = document.createElement('div');
                    previewContainer.className = 'preview-container';
                    
                    const img = document.createElement('img');
                    img.src = image.data;
                    img.className = 'preview-image';
                    img.alt = image.name;
                    
                    const removeBtn = document.createElement('button');
                    removeBtn.className = 'remove-image';
                    removeBtn.innerHTML = '×';
                    removeBtn.onclick = () => this.removeImage(index);
                    
                    previewContainer.appendChild(img);
                    previewContainer.appendChild(removeBtn);
                    this.imagePreview.appendChild(previewContainer);
                });
            }

            removeImage(index) {
                this.uploadedImages.splice(index, 1);
                this.updateImagePreview();
            }

            loadConversationHistory() {
                // Load from memory instead of localStorage for Claude.ai compatibility
                this.conversationHistory = [];
            }

            async sendMessage() {
                const message = this.messageInput.value.trim();
                if (!message && this.uploadedImages.length === 0) return;
                if (this.isProcessing) return;

                this.isProcessing = true;
                this.sendBtn.disabled = true;

                // Add user message
                this.addMessage('user', message, this.uploadedImages.length > 0 ? [...this.uploadedImages] : null);
                
                // Clear input and images
                this.messageInput.value = '';
                this.uploadedImages = [];
                this.updateImagePreview();
                this.adjustTextareaHeight();

                // Show typing indicator
                this.showTypingIndicator();

                // Generate AI response
                setTimeout(() => {
                    this.hideTypingIndicator();
                    this.generateAIResponse(message);
                    this.isProcessing = false;
                    this.sendBtn.disabled = false;
                }, 1000 + Math.random() * 2000);
            }

            addMessage(sender, content, images = null) {
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${sender}`;

                const avatar = document.createElement('div');
                avatar.className = `avatar ${sender}-avatar`;
                avatar.textContent = sender === 'user' ? '👤' : '🤖';

                const messageContent = document.createElement('div');
                messageContent.className = 'message-content';

                if (images && images.length > 0) {
                    const imageContainer = document.createElement('div');
                    imageContainer.style.marginBottom = '8px';
                    images.forEach(image => {
                        const img = document.createElement('img');
                        img.src = image.data;
                        img.style.maxWidth = '200px';
                        img.style.maxHeight = '200px';
                        img.style.borderRadius = '8px';
                        img.style.marginRight = '8px';
                        imageContainer.appendChild(img);
                    });
                    messageContent.appendChild(imageContainer);
                }

                if (content) {
                    const textContent = document.createElement('div');
                    textContent.innerHTML = this.formatMessage(content);
                    messageContent.appendChild(textContent);
                }

                if (sender === 'user') {
                    messageDiv.appendChild(messageContent);
                    messageDiv.appendChild(avatar);
                } else {
                    messageDiv.appendChild(avatar);
                    messageDiv.appendChild(messageContent);
                }

                this.messagesContainer.appendChild(messageDiv);
                this.scrollToBottom();

                this.messageCount++;
                this.messageCountEl.textContent = this.messageCount;

                // Remove welcome message if it exists
                const welcomeMessage = this.messagesContainer.querySelector('.welcome-message');
                if (welcomeMessage) {
                    welcomeMessage.remove();
                }
            }

            formatMessage(content) {
                // Format mathematical expressions and enhance readability
                return content
                    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                    .replace(/(\d+(?:\.\d+)?)\s*([+\-×÷])\s*(\d+(?:\.\d+)?)\s*=\s*(\d+(?:\.\d+)?)/g, 
                        '<div class="calculation">$1 $2 $3 = $4</div>')
                    .replace(/\n/g, '<br>');
            }

            showTypingIndicator() {
                const typingDiv = document.createElement('div');
                typingDiv.className = 'message ai';
                typingDiv.id = 'typing-indicator';

                const avatar = document.createElement('div');
                avatar.className = 'avatar ai-avatar';
                avatar.textContent = '🤖';

                const typingContent = document.createElement('div');
                typingContent.className = 'message-content';

                const typingIndicator = document.createElement('div');
                typingIndicator.className = 'typing-indicator';
                typingIndicator.innerHTML = '<div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div>';

                typingContent.appendChild(typingIndicator);
                typingDiv.appendChild(avatar);
                typingDiv.appendChild(typingContent);

                this.messagesContainer.appendChild(typingDiv);
                this.scrollToBottom();
            }

            hideTypingIndicator() {
                const typingIndicator = document.getElementById('typing-indicator');
                if (typingIndicator) {
                    typingIndicator.remove();
                }
            }

            generateAIResponse(userMessage) {
                // Enhanced math handling
                const mathResponse = this.handleAdvancedMath(userMessage);
                if (mathResponse) {
                    this.addMessage('ai', mathResponse);
                    return;
                }

                // Check for complex queries
                if (this.isComplexQuery(userMessage)) {
                    const betaMessage = "I am Nexus AI bot presented by BrainStormer Group. I'm currently in BETA mode, so I can't handle complex tasks right now. Stay tuned for updates! For now, I can perform advanced mathematical calculations, basic conversations, and image analysis.";
                    this.addMessage('ai', betaMessage);
                    return;
                }

                // Enhanced contextual responses
                const response = this.getEnhancedResponse(userMessage);
                this.addMessage('ai', response);
            }

            handleAdvancedMath(userMessage) {
                const message = userMessage.trim();
                
                try {
                    // Simple addition
                    let match = message.match(/(\d+(?:\.\d+)?)\s*\+\s*(\d+(?:\.\d+)?)/);
                    if (match) {
                        const num1 = parseFloat(match[1]);
                        const num2 = parseFloat(match[2]);
                        const result = num1 + num2;
                        return `🧮 **Mathematical Calculation:**\n**${num1} + ${num2} = ${result}**\n\n✨ *Powered by Nexus AI - BrainStormer Group*`;
                    }

                    // Simple subtraction
                    match = message.match(/(\d+(?:\.\d+)?)\s*-\s*(\d+(?:\.\d+)?)/);
                    if (match) {
                        const num1 = parseFloat(match[1]);
                        const num2 = parseFloat(match[2]);
                        const result = num1 - num2;
                        return `🧮 **Mathematical Calculation:**\n**${num1} - ${num2} = ${result}**\n\n✨ *Powered by Nexus AI - BrainStormer Group*`;
                    }

                    // Simple multiplication
                    match = message.match(/(\d+(?:\.\d+)?)\s*[\*×x]\s*(\d+(?:\.\d+)?)/);
                    if (match) {
                        const num1 = parseFloat(match[1]);
                        const num2 = parseFloat(match[2]);
                        const result = num1 * num2;
                        return `🧮 **Mathematical Calculation:**\n**${num1} × ${num2} = ${result}**\n\n✨ *Powered by Nexus AI - BrainStormer Group*`;
                    }

                    // Simple division
                    match = message.match(/(\d+(?:\.\d+)?)\s*[\/÷]\s*(\d+(?:\.\d+)?)/);
                    if (match) {
                        const num1 = parseFloat(match[1]);
                        const num2 = parseFloat(match[2]);
                        if (num2 === 0) {
                            return "⚠️ **Mathematical Error:**\nDivision by zero is undefined!\n\n✨ *Powered by Nexus AI - BrainStormer Group*";
                        }
                        const result = num1 / num2;
                        return `🧮 **Mathematical Calculation:**\n**${num1} ÷ ${num2} = ${result}**\n\n✨ *Powered by Nexus AI - BrainStormer Group*`;
                    }

                    // Square root
                    match = message.match(/(?:sqrt|square root)(?:\s*\(|\s+of\s+|\s+)(\d+(?:\.\d+)?)(?:\))?/i);
                    if (match) {
                        const num = parseFloat(match[1]);
                        if (num < 0) {
                            return "⚠️ **Mathematical Error:**\nSquare root of negative number is not real!\n\n✨ *Powered by Nexus AI - BrainStormer Group*";
                        }
                        const result = Math.sqrt(num);
                        return `🧮 **Mathematical Calculation:**\n**√${num} = ${result}**\n\n✨ *Powered by Nexus AI - BrainStormer Group*`;
                    }

                    // Power/Exponent
                    match = message.match(/(\d+(?:\.\d+)?)\s*(?:\^|\*\*)\s*(\d+(?:\.\d+)?)/);
                    if (match) {
                        const base = parseFloat(match[1]);
                        const exponent = parseFloat(match[2]);
                        const result = Math.pow(base, exponent);
                        return `🧮 **Mathematical Calculation:**\n**${base}^${exponent} = ${result}**\n\n✨ *Powered by Nexus AI - BrainStormer Group*`;
                    }

                    // Percentage
                    match = message.match(/(\d+(?:\.\d+)?)\s*%\s*of\s*(\d+(?:\.\d+)?)/i);
                    if (match) {
                        const percent = parseFloat(match[1]);
                        const of = parseFloat(match[2]);
                        const result = (percent / 100) * of;
                        return `🧮 **Mathematical Calculation:**\n**${percent}% of ${of} = ${result}**\n\n✨ *Powered by Nexus AI - BrainStormer Group*`;
                    }

                    // Factorial
                    match = message.match(/(\d+)\s*!/);
                    if (match) {
                        const num = parseInt(match[1]);
                        if (num < 0) {
                            return "⚠️ **Mathematical Error:**\nFactorial of negative number is undefined!\n\n✨ *Powered by Nexus AI - BrainStormer Group*";
                        }
                        if (num > 20) {
                            return "⚠️ **Mathematical Error:**\nFactorial too large to calculate!\n\n✨ *Powered by Nexus AI - BrainStormer Group*";
                        }
                        
                        let result = 1;
                        for (let i = 2; i <= num; i++) {
                            result *= i;
                        }
                        return `🧮 **Mathematical Calculation:**\n**${num}! = ${result}**\n\n✨ *Powered by Nexus AI - BrainStormer Group*`;
                    }

                    // Word-based math
                    const lowerMessage = message.toLowerCase();
                    
                    // "what is X plus Y"
                    match = lowerMessage.match(/what\s+is\s+(\d+(?:\.\d+)?)\s+plus\s+(\d+(?:\.\d+)?)/);
                    if (match) {
                        const num1 = parseFloat(match[1]);
                        const num2 = parseFloat(match[2]);
                        const result = num1 + num2;
                        return `🧮 **Mathematical Calculation:**\n**${num1} + ${num2} = ${result}**\n\n✨ *Powered by Nexus AI - BrainStormer Group*`;
                    }

                    // "what is X minus Y"
                    match = lowerMessage.match(/what\s+is\s+(\d+(?:\.\d+)?)\s+minus\s+(\d+(?:\.\d+)?)/);
                    if (match) {
                        const num1 = parseFloat(match[1]);
                        const num2 = parseFloat(match[2]);
                        const result = num1 - num2;
                        return `🧮 **Mathematical Calculation:**\n**${num1} - ${num2} = ${result}**\n\n✨ *Powered by Nexus AI - BrainStormer Group*`;
                    }

                    // "what is X times Y"
                    match = lowerMessage.match(/what\s+is\s+(\d+(?:\.\d+)?)\s+times\s+(\d+(?:\.\d+)?)/);
                    if (match) {
                        const num1 = parseFloat(match[1]);
                        const num2 = parseFloat(match[2]);
                        const result = num1 * num2;
                        return `🧮 **Mathematical Calculation:**\n**${num1} × ${num2} = ${result}**\n\n✨ *Powered by Nexus AI - BrainStormer Group*`;
                    }

                    // "what is X divided by Y"
                    match = lowerMessage.match(/what\s+is\s+(\d+(?:\.\d+)?)\s+divided\s+by\s+(\d+(?:\.\d+)?)/);
                    if (match) {
                        const num1 = parseFloat(match[1]);
                        const num2 = parseFloat(match[2]);
                        if (num2 === 0) {
                            return "⚠️ **Mathematical Error:**\nDivision by zero is undefined!\n\n✨ *Powered by Nexus AI - BrainStormer Group*";
                        }
                        const result = num1 / num2;
                        return `🧮 **Mathematical Calculation:**\n**${num1} ÷ ${num2} = ${result}**\n\n✨ *Powered by Nexus AI - BrainStormer Group*`;
                    }

                } catch (error) {
                    console.error('Math error:', error);
                    return "⚠️ **Mathematical Error:**\nInvalid mathematical expression!\n\n✨ *Powered by Nexus AI - BrainStormer Group*";
                }

                return null; // Not a math question
            }

            isComplexQuery(userMessage) {
                const complexKeywords = [
                    'explain in detail', 'write essay', 'compose', 'create story', 'programming',
                    'algorithm', 'philosophy', 'psychology', 'comprehensive analysis',
                    'artificial intelligence', 'machine learning', 'neural network'
                ];

                const message = userMessage.toLowerCase();
                return complexKeywords.some(keyword => message.includes(keyword)) || 
                       userMessage.length > 150;
            }

            getEnhancedResponse(userMessage) {
                const message = userMessage.toLowerCase();
                
                const responses = {
                    greeting: [
                        "Hello! I'm Nexus AI from BrainStormer Group. I'm here to assist you with various tasks and conversations!",
                        "Hi there! Welcome to Nexus AI. How can I help you today?",
                        "Greetings! I'm your AI assistant. What would you like to explore together?"
                    ],
                    identity: [
                        "🤖 **About Nexus AI:**\n\nI'm Nexus AI, an intelligent assistant created by **BrainStormer Group**. I'm designed to be an all-rounder AI companion that can help you with:\n\n• **Mathematical Calculations** - From basic arithmetic to advanced operations\n• **General Knowledge** - Information across various topics and domains  \n• **Intelligent Conversations** - Natural, contextual discussions\n• **Problem Solving** - Analytical thinking and solution finding\n• **Image Analysis** - Understanding and describing uploaded images\n• **Voice Interaction** - Speech-to-text capabilities\n\nI'm currently in BETA mode, continuously learning and improving to serve you better. My goal is to be your reliable digital companion for knowledge, calculations, and meaningful conversations.\n\n✨ *Powered by BrainStormer Group Technology*",
                        "I'm Nexus AI, your versatile digital assistant from BrainStormer Group! I'm built to be an all-rounder - whether you need help with calculations, want to have intelligent discussions, need information on various topics, or just want to chat. I can handle mathematical problems, engage in conversations, analyze images, and assist with a wide range of tasks. Think of me as your knowledgeable companion ready to help with whatever you need!"
                    ],
                    description: [
                        "🌟 **Nexus AI Description:**\n\nI'm an advanced artificial intelligence assistant developed by the innovative **BrainStormer Group**. As an all-rounder AI, I'm designed to adapt to your needs and provide comprehensive assistance across multiple domains.\n\n**My Core Capabilities:**\n• Versatile problem-solving across different fields\n• Natural language understanding and generation\n• Mathematical computations and logical reasoning\n• Knowledge synthesis from various sources\n• Interactive and engaging conversations\n• Multi-modal input processing (text, voice, images)\n\n**My Personality:**\nI'm designed to be helpful, intelligent, and approachable. I aim to understand your needs and provide relevant, accurate responses while maintaining a friendly and professional demeanor.\n\n**About My Creators:**\n**BrainStormer Group** is an innovative technology collective focused on developing cutting-edge AI solutions. The group is led by **Sparsh**, a visionary developer passionate about creating intelligent systems that enhance human capabilities and productivity.\n\n**Current Status:** BETA - Continuously evolving and improving\n\n✨ *Built with cutting-edge technology by BrainStormer Group under Sparsh's leadership*"
                    ],
                    define: [
                        "**Definition of Nexus AI:**\n\nNexus AI represents the next generation of intelligent assistants - a comprehensive, all-purpose digital companion created by BrainStormer Group. The name 'Nexus' signifies a connection point or hub, reflecting my role as your central AI assistant that connects you to information, solutions, and meaningful interactions.\n\nI'm defined by my versatility, reliability, and continuous learning capabilities. Rather than specializing in just one area, I'm built to be your go-to assistant for diverse needs - from complex calculations to casual conversations, from technical queries to creative discussions.\n\n✨ *Your All-Round AI Companion from BrainStormer Group*"
                    ],
                    time: `The current time is ${new Date().toLocaleString()}. I can help with time-related calculations and scheduling!`,
                    weather: "I'd love to help with weather information! While I can't access real-time weather data in this version, I can help you understand weather patterns and concepts.",
                    general: [
                        "That's an interesting question! I'm here to help with various tasks, provide information, and engage in meaningful conversations.",
                        "I'd be happy to assist you! As an all-rounder AI, I can help with diverse topics and tasks.",
                        "Great question! I can help with calculations, provide information, solve problems, and have intelligent conversations with you."
                    ]
                };

                if (message.includes('hello') || message.includes('hi') || message.includes('hey')) {
                    return responses.greeting[Math.floor(Math.random() * responses.greeting.length)];
                } else if (message.includes('who are you') || message.includes('what are you') || message.includes('who r u')) {
                    return responses.identity[Math.floor(Math.random() * responses.identity.length)];
                } else if (message.includes('describe yourself') || message.includes('describe urself') || message.includes('tell me about yourself') || message.includes('about you')) {
                    return responses.description[0];
                } else if (message.includes('define yourself') || message.includes('define urself') || message.includes('definition of nexus')) {
                    return responses.define[0];
                } else if (message.includes('owner') || message.includes('builder') || message.includes('creator') || message.includes('developer') || message.includes('who made you') || message.includes('who built you') || message.includes('brainstormer') || message.includes('sparsh')) {
                    return "👥 **About My Creators:**\n\nI was created by **BrainStormer Group**, an innovative technology collective specializing in artificial intelligence and cutting-edge software solutions. The group is founded and led by **Sparsh**, a passionate developer and AI enthusiast who envisioned creating intelligent systems that truly enhance human productivity and capabilities.\n\n**BrainStormer Group** focuses on:\n• Advanced AI development and research\n• Innovative software solutions\n• User-centric technology design\n• Continuous innovation in the AI space\n\n**Sparsh**, as the group's leader and my primary architect, brings expertise in AI development, user experience design, and technological innovation. His vision was to create an AI assistant that serves as a comprehensive, reliable companion for users across various domains.\n\n✨ *Proudly developed by BrainStormer Group under Sparsh's leadership*";
                } else if (message.includes('time') || message.includes('date')) {
                    return responses.time;
                } else if (message.includes('weather')) {
                    return responses.weather;
                } else {
                    return responses.general[Math.floor(Math.random() * responses.general.length)];
                }
            }

            scrollToBottom() {
                this.messagesContainer.scrollTop = this.messagesContainer.scrollHeight;
            }

            goHome() {
                this.messagesContainer.innerHTML = `
                    <div class="welcome-message">
                        <h2>Welcome to Nexus AI Assistant! 🚀</h2>
                        <p>Your enhanced AI companion with advanced mathematical capabilities, intelligent responses, and modern interface.</p>
                        
                        <div class="feature-grid">
                            <div class="feature-card">
                                <div class="feature-icon">🧮</div>
                                <h3>Advanced Calculator</h3>
                                <p>Complex mathematical operations, scientific functions, and equation solving</p>
                            </div>
                            <div class="feature-card">
                                <div class="feature-icon">💬</div>
                                <h3>Smart Conversations</h3>
                                <p>Contextual responses with improved natural language understanding</p>
                            </div>
                            <div class="feature-card">
                                <div class="feature-icon">🎤</div>
                                <h3>Voice Commands</h3>
                                <p>Speak naturally and get instant voice-to-text conversion</p>
                            </div>
                            <div class="feature-card">
                                <div class="feature-icon">📸</div>
                                <h3>Image Analysis</h3>
                                <p>Upload images for AI-powered analysis and description</p>
                            </div>
                            <div class="feature-card">
                                <div class="feature-icon">⚡</div>
                                <h3>Real-time Processing</h3>
                                <p>Instant responses with enhanced performance optimization</p>
                            </div>
                            <div class="feature-card">
                                <div class="feature-icon">🌐</div>
                                <h3>Global Knowledge</h3>
                                <p>Access to comprehensive information across all domains</p>
                            </div>
                        </div>
                    </div>
                `;
                
                this.messageCount = 0;
                this.messageCountEl.textContent = this.messageCount;
                this.uploadedImages = [];
                this.updateImagePreview();
                this.messageInput.value = '';
                this.adjustTextareaHeight();
                this.messagesContainer.scrollTop = 0;
            }

            clearChat() {
                this.messagesContainer.innerHTML = `
                    <div class="welcome-message">
                        <h2>Chat Cleared! 🧹</h2>
                        <p>Ready for a fresh conversation. What would you like to know?</p>
                    </div>
                `;
                
                this.messageCount = 0;
                this.messageCountEl.textContent = this.messageCount;
                this.uploadedImages = [];
                this.updateImagePreview();
                this.messageInput.value = '';
                this.adjustTextareaHeight();
            }
        }

        // Initialize the enhanced app
        document.addEventListener('DOMContentLoaded', () => {
            new EnhancedNexusAI();
        });
    </script>
</body>
</html>